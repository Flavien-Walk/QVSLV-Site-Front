<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QVSLV - Archives & Documentation Alternative</title>
    <link rel="icon" type="image/png" href="assets/accueil/favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles/styles.css">
</head>
<body>
    <!-- Particules d'arri√®re-plan -->
    <div class="particles" id="particles"></div>
    
    <!-- Cadre d√©coratif du site -->
    <div class="site-frame">
        <div class="frame-corner top-left"></div>
        <div class="frame-corner top-right"></div>
        <div class="frame-corner bottom-left"></div>
        <div class="frame-corner bottom-right"></div>
        <div class="frame-border top"></div>
        <div class="frame-border bottom"></div>
        <div class="frame-border left"></div>
        <div class="frame-border right"></div>
    </div>
    
    <!-- Conteneur principal -->
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">  
                    <div class="logo-container">
                        <img src="/assets/accueil/logo.png" alt="QVSLV Logo" class="logo-image">
                        <div class="logo-text">
                            <h1 class="glitch" data-text="QVSLV">QVSLV</h1>
                            <span class="tagline">Archives & Documentation</span>
                        </div>
                    </div>
                    <div class="access-level" id="accessLevel">
                        <span class="level-indicator">NIVEAU D'ACC√àS:</span>
                        <span class="level-badge" id="levelBadge">ANONYME</span>
                    </div>
                </div>
                
                <nav class="main-nav">
                    <a href="#" class="nav-link active">Accueil</a>
                    <a href="#" class="nav-link">Dossiers</a>
                    <a href="#" class="nav-link">Archives</a>
                    <a href="#" class="nav-link">Th√©ories</a>
                    <a href="#" class="nav-link">Ressources</a>
                    <!-- Section authentification dynamique -->
                    <div class="auth-section" id="authSection">
                        <a href="login.html" class="nav-link login-btn" id="loginLink">Connexion</a>
                    </div>
                </nav>
                
                <div class="header-controls">
                    <button class="theme-toggle" id="themeToggle" title="Changer le th√®me">üåô</button>
                    <button class="notification-btn" id="notificationBtn" title="Notifications">
                        üîî
                        <span class="notification-count">3</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Barre d'outils -->
        <section class="toolbar">
            <div class="search-container">
                <input type="text" id="globalSearch" placeholder="Rechercher dans les archives..." class="search-input">
                <button class="search-btn">üîç</button>
                <div class="search-filters">
                    <button class="filter-btn active" data-filter="all">Tout</button>
                    <button class="filter-btn" data-filter="archives">Archives</button>
                    <button class="filter-btn" data-filter="recent">R√©cent</button>
                    <button class="filter-btn" data-filter="classified">Classifi√©</button>
                </div>
            </div>
            <div class="toolbar-actions">
                <button class="action-btn" id="randomDocument" title="Document al√©atoire">üé≤</button>
                <button class="action-btn" id="bookmarks" title="Signets">‚≠ê</button>
                <button class="action-btn" id="downloadMode" title="Mode t√©l√©chargement">üì•</button>
                <div class="view-toggle">
                    <button class="view-btn active" data-view="grid">‚äû</button>
                    <button class="view-btn" data-view="list">‚ò∞</button>
                </div>
            </div>
        </section>

        <!-- Contenu principal avec sidebar -->
        <div class="main-layout">
            <!-- Contenu principal -->
            <main class="main-content">
                <div class="content-header">
                    <h2>Base de Donn√©es D√©centralis√©e</h2>
                    <div class="content-stats">
                        <span class="stat">1,247 Archives</span>
                        <span class="stat">‚ö° Mise √† jour en temps r√©el</span>
                    </div>
                </div>

                <!-- Message de bienvenue pour utilisateur connect√© -->
                <div class="welcome-message" id="welcomeMessage" style="display: none;">
                    <div class="welcome-content">
                        <h3>Bienvenue, <span id="welcomeUsername">Agent</span></h3>
                        <p>Vous avez maintenant acc√®s aux archives de niveau <span id="welcomeLevel">V√âRIFI√â</span></p>
                        <div class="access-stats">
                            <span class="access-stat">+127 documents d√©bloqu√©s</span>
                            <span class="access-stat">Derni√®re connexion: <span id="lastLogin">Jamais</span></span>
                        </div>
                    </div>
                </div>

                <!-- Shoutbox -->
                <section class="shoutbox">
                    <div class="shoutbox-header">
                        <h3>Terminal de Communication</h3>
                        <div class="shoutbox-controls">
                            <span class="online-count" id="onlineCount">12 connect√©s</span>
                            <button class="minimize-btn" id="minimizeShoutbox">‚àí</button>
                        </div>
                    </div>
                    <div class="shoutbox-body" id="shoutboxBody">
                        <div class="messages-container" id="messagesContainer">
                            <div class="message">
                                <span class="message-user admin">Archiviste_7</span>
                                <span class="message-time">14:32</span>
                                <span class="message-text">Nouveau document d√©classifi√© disponible dans la section Vatican üìú</span>
                            </div>
                            <div class="message">
                                <span class="message-user verified">Cipher_01</span>
                                <span class="message-time">14:35</span>
                                <span class="message-text">Int√©ressant, j'analyse üß†</span>
                            </div>
                            <div class="message system" id="systemMessage" style="display: none;">
                                <span class="message-user system">SYST√àME</span>
                                <span class="message-time" id="systemTime"></span>
                                <span class="message-text" id="systemText"></span>
                            </div>
                        </div>
                        <div class="message-input-container" id="messageInputContainer">
                            <div class="message-controls">
                                <input type="text" id="messageInput" placeholder="Connectez-vous pour participer..." maxlength="200" disabled>
                                <button id="emojiButton" class="control-btn" disabled>üòä</button>
                                <button id="sendButton" class="send-button" disabled>Envoyer</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Grille des cat√©gories -->
                <div class="categories-container">
                    <div class="categories-grid">
                        <div class="category-card" data-category="archives">
                            <div class="card-header">
                                <div class="category-icon">üìÇ</div>
                                <div class="security-level high">TOP SECRET</div>
                            </div>
                            <div class="card-content">
                                <h3>Archives Classifi√©es</h3>
                                <p>Documents d√©classifi√©s, fuites gouvernementales et archives historiques confidentielles</p>
                                <div class="card-stats">
                                    <span class="category-count">247 dossiers</span>
                                    <span class="last-update">Maj: 2h</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="category-card" data-category="ancient">
                            <div class="card-header">
                                <div class="category-icon">üèõÔ∏è</div>
                                <div class="security-level medium">CONFIDENTIEL</div>
                            </div>
                            <div class="card-content">
                                <h3>Civilisations Anciennes</h3>
                                <p>Sum√©riens, √âgypte antique, technologies perdues et myst√®res arch√©ologiques</p>
                                <div class="card-stats">
                                    <span class="category-count">156 analyses</span>
                                    <span class="last-update">Maj: 5h</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="category-card" data-category="social">
                            <div class="card-header">
                                <div class="category-icon">üß†</div>
                                <div class="security-level high">RESTREINT</div>
                            </div>
                            <div class="card-content">
                                <h3>Ing√©nierie Sociale</h3>
                                <p>Manipulation de masse, propagande, contr√¥le de l'information et psychologie collective</p>
                                <div class="card-stats">
                                    <span class="category-count">89 √©tudes</span>
                                    <span class="last-update">Maj: 1h</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="category-card" data-category="tech">
                            <div class="card-header">
                                <div class="category-icon">‚öôÔ∏è</div>
                                <div class="security-level medium">CLASSIFI√â</div>
                            </div>
                            <div class="card-content">
                                <h3>Technologies Oubli√©es</h3>
                                <p>Inventions supprim√©es, √©nergies alternatives et d√©couvertes dissimul√©es</p>
                                <div class="card-stats">
                                    <span class="category-count">134 recherches</span>
                                    <span class="last-update">Maj: 3h</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="category-card" data-category="consciousness">
                            <div class="card-header">
                                <div class="category-icon">üåå</div>
                                <div class="security-level low">OUVERT</div>
                            </div>
                            <div class="card-content">
                                <h3>Physique & Conscience</h3>
                                <p>M√©canique quantique, conscience, dimensions et th√©ories de la r√©alit√©</p>
                                <div class="card-stats">
                                    <span class="category-count">78 th√©ories</span>
                                    <span class="last-update">Maj: 4h</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="category-card" data-category="symbols">
                            <div class="card-header">
                                <div class="category-icon">üî∫</div>
                                <div class="security-level high">√âSOT√âRIQUE</div>
                            </div>
                            <div class="card-content">
                                <h3>Symbolisme & Langage</h3>
                                <p>Codes cach√©s, symbolisme √©sot√©rique, langages secrets et occultisme</p>
                                <div class="card-stats">
                                    <span class="category-count">203 d√©codages</span>
                                    <span class="last-update">Maj: 6h</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Panel de contr√¥le -->
                <div class="sidebar-block">
                    <h4>Tableau de Bord</h4>
                    <div class="system-status">
                        <div class="status-item">
                            <span class="status-label">Chiffrement</span>
                            <span class="status-value active">AES-256</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Anonymat</span>
                            <span class="status-value active">TOR + VPN</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Serveurs</span>
                            <span class="status-value active">12/15</span>
                        </div>
                    </div>
                </div>

                <!-- Profil utilisateur (visible si connect√©) -->
                <div class="sidebar-block" id="userProfileBlock" style="display: none;">
                    <h4>Profil Agent</h4>
                    <div class="user-profile">
                        <div class="profile-avatar">üë§</div>
                        <div class="profile-info">
                            <div class="profile-name" id="profileName">Agent</div>
                            <div class="profile-role" id="profileRole">ANONYME</div>
                            <div class="profile-specialty" id="profileSpecialty">Non d√©fini</div>
                        </div>
                        <div class="profile-stats">
                            <div class="stat-row">
                                <span class="stat-label">Contributions:</span>
                                <span class="stat-value">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Documents vus:</span>
                                <span class="stat-value">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Membres en ligne -->
                <div class="sidebar-block">
                    <h4>Membres en ligne</h4>
                    <div class="online-members" id="onlineMembers">
                        <div class="member admin">
                            <span class="status-dot"></span>
                            <span class="member-name">Archiviste_7</span>
                            <span class="member-badge">ADMIN</span>
                        </div>
                        <div class="member verified">
                            <span class="status-dot"></span>
                            <span class="member-name">Cipher_01</span>
                            <span class="member-badge">V√âRIFI√â</span>
                        </div>
                        <div class="member">
                            <span class="status-dot"></span>
                            <span class="member-name">DeepSeeker</span>
                            <span class="member-badge">CHERCHEUR</span>
                        </div>
                        <div class="member">
                            <span class="status-dot"></span>
                            <span class="member-name">VaultKeeper</span>
                            <span class="member-badge">GARDIEN</span>
                        </div>
                        <div class="member">
                            <span class="status-dot"></span>
                            <span class="member-name">CodeBreaker</span>
                            <span class="member-badge">EXPERT</span>
                        </div>
                        <div class="member">
                            <span class="status-dot"></span>
                            <span class="member-name">TruthSeeker</span>
                            <span class="member-badge">ANALYSTE</span>
                        </div>
                    </div>
                </div>

                <!-- Statistiques -->
                <div class="sidebar-block">
                    <h4>M√©triques du R√©seau</h4>
                    <div class="stats">
                        <div class="stat-item">
                            <span class="stat-number">1,247</span>
                            <span class="stat-label">Archives</span>
                            <div class="stat-trend up">‚Üó +15</div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="agentCount">8,934</span>
                            <span class="stat-label">Agents</span>
                            <div class="stat-trend up">‚Üó +127</div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">42,156</span>
                            <span class="stat-label">Discussions</span>
                            <div class="stat-trend up">‚Üó +1,432</div>
                        </div>
                    </div>
                </div>

                <!-- Activit√© r√©cente -->
                <div class="sidebar-block">
                    <h4>Activit√© R√©cente</h4>
                    <div class="activity-feed">
                        <div class="activity-item">
                            <div class="activity-time">Il y a 2min</div>
                            <div class="activity-text">Document <strong>Vatican-2025</strong> ajout√©</div>
                            <div class="activity-user">par Archiviste_7</div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">Il y a 5min</div>
                            <div class="activity-text">Nouvelle th√©orie sur <strong>Tesla</strong></div>
                            <div class="activity-user">par DeepSeeker</div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">Il y a 12min</div>
                            <div class="activity-text">Code d√©crypt√©: <strong>Atlantide</strong></div>
                            <div class="activity-user">par Cipher_01</div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-section primary">
                    <div class="footer-logo">
                        <h3>QVSLV</h3>
                        <p>La v√©rit√© n'attend pas la permission d'√™tre r√©v√©l√©e</p>
                        <div class="verification-badge">
                            <span class="badge-icon">üîê</span>
                            <span class="badge-text">V√©rifi√© & D√©centralis√©</span>
                        </div>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h4>Archives</h4>
                    <div class="footer-links">
                        <a href="#">Documents r√©cents</a>
                        <a href="#">Dossiers classifi√©s</a>
                        <a href="#">Base de donn√©es</a>
                        <a href="#">Chronologies</a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h4>Outils</h4>
                    <div class="footer-links">
                        <a href="#">Guide de v√©rification</a>
                        <a href="#">D√©cryptage automatique</a>
                        <a href="#">Analyseur de documents</a>
                        <a href="#">API d√©veloppeurs</a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h4>R√©seau</h4>
                    <div class="footer-links">
                        <a href="#">Devenir contributeur</a>
                        <a href="#">Signaler une information</a>
                        <a href="#">Forum s√©curis√©</a>
                        <a href="#">Contact anonyme</a>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <div class="footer-info">
                    <p>&copy; 2025 QVSLV - R√©seau de Documentation D√©centralis√©</p>
                    <div class="footer-tagline">
                        <span class="encrypted-text">D√âCENTRALIS√â</span> ‚Ä¢ 
                        <span class="encrypted-text">V√âRIFI√â</span> ‚Ä¢ 
                        <span class="encrypted-text">ANONYME</span>
                    </div>
                </div>
                <div class="footer-status">
                    <div class="network-stats">
                        <div class="network-stat">
                            <span class="stat-value">15</span>
                            <span class="stat-label">N≈ìuds actifs</span>
                        </div>
                        <div class="network-stat">
                            <span class="stat-value">99.8%</span>
                            <span class="stat-label">Disponibilit√©</span>
                        </div>
                    </div>
                    <div class="status-indicator">
                        <span class="status-dot active"></span>
                        <span class="status-text">R√©seau op√©rationnel</span>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Picker d'√©mojis -->
    <div class="emoji-picker" id="emojiPicker">
        <div class="emoji-grid">
            <span class="emoji" data-emoji="üòä">üòä</span>
            <span class="emoji" data-emoji="üòé">üòé</span>
            <span class="emoji" data-emoji="üî•">üî•</span>
            <span class="emoji" data-emoji="üß†">üß†</span>
            <span class="emoji" data-emoji="üëÅÔ∏è">üëÅÔ∏è</span>
            <span class="emoji" data-emoji="üìú">üìú</span>
            <span class="emoji" data-emoji="üöÄ">üöÄ</span>
            <span class="emoji" data-emoji="üß¨">üß¨</span>
            <span class="emoji" data-emoji="üîç">üîç</span>
            <span class="emoji" data-emoji="‚ö°">‚ö°</span>
            <span class="emoji" data-emoji="üåå">üåå</span>
            <span class="emoji" data-emoji="üîí">üîí</span>
            <span class="emoji" data-emoji="üõ∏">üõ∏</span>
            <span class="emoji" data-emoji="üé≠">üé≠</span>
            <span class="emoji" data-emoji="üóùÔ∏è">üóùÔ∏è</span>
            <span class="emoji" data-emoji="üì°">üì°</span>
        </div>
    </div>

    <!-- Menu profil utilisateur -->
    <div class="user-menu" id="userMenu" style="display: none;">
        <div class="user-menu-header">
            <div class="user-avatar">üë§</div>
            <div class="user-info">
                <span class="user-name" id="userName">Agent</span>
                <span class="user-role" id="userRole">ANONYME</span>
            </div>
        </div>
        <div class="user-menu-actions">
            <a href="#" class="menu-action" id="profileAction">
                <span class="action-icon">üë§</span>
                <span class="action-text">Mon Profil</span>
            </a>
            <a href="#" class="menu-action" id="settingsAction">
                <span class="action-icon">‚öôÔ∏è</span>
                <span class="action-text">Param√®tres</span>
            </a>
            <a href="#" class="menu-action" id="logoutAction">
                <span class="action-icon">üö™</span>
                <span class="action-text">D√©connexion</span>
            </a>
        </div>
    </div>

    <!-- Notifications -->
    <div class="notification-container" id="notificationContainer"></div>

    <script>
        // Configuration API
        const API_BASE_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000/api' 
            : 'https://qvslv-site.onrender.com/api';

        // Variables globales pour l'authentification
        let currentUser = null;
        let authToken = null;

        // Gestion de l'authentification
        class AuthManager {
            constructor() {
                this.checkAuthStatus();
                this.initAuthEventListeners();
            }

            async checkAuthStatus() {
                // V√©rifier le token stock√©
                authToken = localStorage.getItem('qvslv_token') || sessionStorage.getItem('qvslv_token');
                
                if (authToken) {
                    try {
                        const response = await fetch(`${API_BASE_URL}/auth/verify`, {
                            headers: {
                                'Authorization': `Bearer ${authToken}`
                            }
                        });

                        if (response.ok) {
                            const data = await response.json();
                            currentUser = data.user;
                            this.updateUI(true);
                            this.showSystemMessage(`Agent ${currentUser.username} connect√© au r√©seau`);
                        } else {
                            this.logout();
                        }
                    } catch (error) {
                        console.error('Erreur v√©rification auth:', error);
                        this.logout();
                    }
                } else {
                    this.updateUI(false);
                }
            }

            updateUI(isAuthenticated) {
                const authSection = document.getElementById('authSection');
                const levelBadge = document.getElementById('levelBadge');
                const messageInput = document.getElementById('messageInput');
                const emojiButton = document.getElementById('emojiButton');
                const sendButton = document.getElementById('sendButton');
                const welcomeMessage = document.getElementById('welcomeMessage');
                const userProfileBlock = document.getElementById('userProfileBlock');

                if (isAuthenticated && currentUser) {
                    // Utilisateur connect√©
                    authSection.innerHTML = `
                        <div class="user-profile-btn" id="userProfileBtn">
                            <span class="user-avatar-small">üë§</span>
                            <span class="user-name-small">${currentUser.username}</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </div>
                    `;

                    // Mettre √† jour le niveau d'acc√®s
                    levelBadge.textContent = currentUser.role || 'V√âRIFI√â';
                    levelBadge.className = `level-badge ${(currentUser.role || 'V√âRIFI√â').toLowerCase()}`;

                    // Afficher le message de bienvenue
                    if (welcomeMessage) {
                        document.getElementById('welcomeUsername').textContent = currentUser.username;
                        document.getElementById('welcomeLevel').textContent = currentUser.role || 'V√âRIFI√â';
                        welcomeMessage.style.display = 'block';
                    }

                    // Afficher le profil utilisateur dans la sidebar
                    if (userProfileBlock) {
                        document.getElementById('profileName').textContent = currentUser.username;
                        document.getElementById('profileRole').textContent = currentUser.role || 'V√âRIFI√â';
                        document.getElementById('profileSpecialty').textContent = this.getSpecializationName(currentUser.specialization);
                        userProfileBlock.style.display = 'block';
                    }

                    // Activer la shoutbox
                    messageInput.placeholder = `Tapez votre message, ${currentUser.username}...`;
                    messageInput.disabled = false;
                    emojiButton.disabled = false;
                    sendButton.disabled = false;

                    // Ajouter l'utilisateur √† la liste des membres en ligne
                    this.addUserToOnlineList();

                    // Ajouter l'event listener pour le menu profil
                    setTimeout(() => {
                        const userProfileBtn = document.getElementById('userProfileBtn');
                        if (userProfileBtn) {
                            userProfileBtn.addEventListener('click', (e) => {
                                e.stopPropagation();
                                this.toggleUserMenu();
                            });
                        }
                    }, 100);

                } else {
                    // Utilisateur non connect√©
                    authSection.innerHTML = `
                        <a href="login.html" class="nav-link login-btn">Connexion</a>
                    `;

                    levelBadge.textContent = 'ANONYME';
                    levelBadge.className = 'level-badge anonymous';

                    // Masquer le message de bienvenue et le profil
                    if (welcomeMessage) welcomeMessage.style.display = 'none';
                    if (userProfileBlock) userProfileBlock.style.display = 'none';

                    // D√©sactiver la shoutbox
                    messageInput.placeholder = 'Connectez-vous pour participer...';
                    messageInput.disabled = true;
                    emojiButton.disabled = true;
                    sendButton.disabled = true;
                }
            }

            getSpecializationName(specialization) {
                const specializations = {
                    'archives': 'Archives & Documentation',
                    'ancient': 'Civilisations Anciennes',
                    'social': 'Ing√©nierie Sociale',
                    'tech': 'Technologies Oubli√©es',
                    'consciousness': 'Physique & Conscience',
                    'symbols': 'Symbolisme & Langage',
                    'crypto': 'Cryptomonnaies',
                    'research': 'Recherche G√©n√©rale'
                };
                return specializations[specialization] || 'Non sp√©cifi√©';
            }

            addUserToOnlineList() {
                if (!currentUser) return;

                const onlineMembers = document.getElementById('onlineMembers');
                if (!onlineMembers) return;

                // V√©rifier si l'utilisateur n'est pas d√©j√† dans la liste
                const existingMember = onlineMembers.querySelector(`[data-username="${currentUser.username}"]`);
                if (existingMember) return;

                const memberElement = document.createElement('div');
                memberElement.className = `member ${(currentUser.role || 'verified').toLowerCase()}`;
                memberElement.setAttribute('data-username', currentUser.username);
                memberElement.innerHTML = `
                    <span class="status-dot"></span>
                    <span class="member-name">${currentUser.username}</span>
                    <span class="member-badge">${(currentUser.role || 'V√âRIFI√â').toUpperCase()}</span>
                `;

                // Ins√©rer en premi√®re position
                onlineMembers.insertBefore(memberElement, onlineMembers.firstChild);

                // Mettre √† jour le compteur
                this.updateOnlineCount();
            }

            updateOnlineCount() {
                const onlineCount = document.getElementById('onlineCount');
                const members = document.querySelectorAll('#onlineMembers .member');
                if (onlineCount) {
                    onlineCount.textContent = `${members.length} connect√©s`;
                }
            }

            toggleUserMenu() {
                const userMenu = document.getElementById('userMenu');
                const userName = document.getElementById('userName');
                const userRole = document.getElementById('userRole');

                if (currentUser) {
                    userName.textContent = currentUser.username;
                    userRole.textContent = currentUser.role || 'V√âRIFI√â';
                }

                const isVisible = userMenu.style.display !== 'none';
                userMenu.style.display = isVisible ? 'none' : 'block';

                if (!isVisible) {
                    // Positionner le menu sous le bouton
                    const userProfileBtn = document.getElementById('userProfileBtn');
                    if (userProfileBtn) {
                        const rect = userProfileBtn.getBoundingClientRect();
                        userMenu.style.position = 'fixed';
                        userMenu.style.top = (rect.bottom + 5) + 'px';
                        userMenu.style.right = '20px';
                    }
                }
            }

            showSystemMessage(message) {
                const systemMessage = document.getElementById('systemMessage');
                const systemTime = document.getElementById('systemTime');
                const systemText = document.getElementById('systemText');

                if (systemMessage && systemTime && systemText) {
                    const now = new Date();
                    systemTime.textContent = now.toLocaleTimeString('fr-FR', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    systemText.textContent = message;
                    systemMessage.style.display = 'block';

                    // Faire d√©filer vers le bas
                    const messagesContainer = document.getElementById('messagesContainer');
                    if (messagesContainer) {
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    }

                    // Masquer apr√®s 5 secondes
                    setTimeout(() => {
                        systemMessage.style.display = 'none';
                    }, 5000);
                }
            }

            initAuthEventListeners() {
                // Fermer le menu utilisateur en cliquant ailleurs
                document.addEventListener('click', (e) => {
                    const userMenu = document.getElementById('userMenu');
                    const userProfileBtn = document.getElementById('userProfileBtn');
                    
                    if (userMenu && userProfileBtn && 
                        !userMenu.contains(e.target) && 
                        !userProfileBtn.contains(e.target)) {
                        userMenu.style.display = 'none';
                    }
                });

                // Event listener pour la d√©connexion
                document.addEventListener('click', (e) => {
                    if (e.target.closest('#logoutAction')) {
                        e.preventDefault();
                        this.logout();
                    }
                });

                // Event listener pour le profil
                document.addEventListener('click', (e) => {
                    if (e.target.closest('#profileAction')) {
                        e.preventDefault();
                        this.showNotification('Page de profil en cours de d√©veloppement', 'info');
                    }
                });

                // Event listener pour les param√®tres
                document.addEventListener('click', (e) => {
                    if (e.target.closest('#settingsAction')) {
                        e.preventDefault();
                        this.showNotification('Param√®tres en cours de d√©veloppement', 'info');
                    }
                });

                // Gestion de la shoutbox
                this.initShoutboxListeners();
            }

            initShoutboxListeners() {
                const messageInput = document.getElementById('messageInput');
                const sendButton = document.getElementById('sendButton');
                const emojiButton = document.getElementById('emojiButton');
                const emojiPicker = document.getElementById('emojiPicker');

                // Envoyer message avec Entr√©e
                messageInput?.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !messageInput.disabled) {
                        this.sendMessage();
                    }
                });

                // Bouton envoyer
                sendButton?.addEventListener('click', () => {
                    if (!sendButton.disabled) {
                        this.sendMessage();
                    }
                });

                // Bouton emoji
                emojiButton?.addEventListener('click', (e) => {
                    if (!emojiButton.disabled) {
                        e.stopPropagation();
                        const isVisible = emojiPicker.style.display !== 'none';
                        emojiPicker.style.display = isVisible ? 'none' : 'block';
                        
                        if (!isVisible) {
                            const rect = emojiButton.getBoundingClientRect();
                            emojiPicker.style.position = 'fixed';
                            emojiPicker.style.top = (rect.top - emojiPicker.offsetHeight - 5) + 'px';
                            emojiPicker.style.left = rect.left + 'px';
                        }
                    }
                });

                // S√©lection d'emoji
                emojiPicker?.addEventListener('click', (e) => {
                    if (e.target.classList.contains('emoji')) {
                        const emoji = e.target.getAttribute('data-emoji');
                        messageInput.value += emoji;
                        emojiPicker.style.display = 'none';
                        messageInput.focus();
                    }
                });

                // Fermer emoji picker en cliquant ailleurs
                document.addEventListener('click', (e) => {
                    if (!emojiButton?.contains(e.target) && !emojiPicker?.contains(e.target)) {
                        emojiPicker.style.display = 'none';
                    }
                });

                // Minimiser shoutbox
                document.getElementById('minimizeShoutbox')?.addEventListener('click', () => {
                    const shoutboxBody = document.getElementById('shoutboxBody');
                    const minimizeBtn = document.getElementById('minimizeShoutbox');
                    
                    if (shoutboxBody.style.display === 'none') {
                        shoutboxBody.style.display = 'block';
                        minimizeBtn.textContent = '‚àí';
                    } else {
                        shoutboxBody.style.display = 'none';
                        minimizeBtn.textContent = '+';
                    }
                });
            }

            sendMessage() {
                const messageInput = document.getElementById('messageInput');
                const message = messageInput.value.trim();

                if (!message || !currentUser) return;

                // Cr√©er l'√©l√©ment message
                const messagesContainer = document.getElementById('messagesContainer');
                const messageElement = document.createElement('div');
                messageElement.className = 'message';
                
                const now = new Date();
                const timeString = now.toLocaleTimeString('fr-FR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });

                messageElement.innerHTML = `
                    <span class="message-user ${(currentUser.role || 'verified').toLowerCase()}">${currentUser.username}</span>
                    <span class="message-time">${timeString}</span>
                    <span class="message-text">${this.escapeHtml(message)}</span>
                `;

                messagesContainer.appendChild(messageElement);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

                // Vider le champ de saisie
                messageInput.value = '';

                // Ici vous pourriez envoyer le message au serveur
                // await this.sendMessageToServer(message);
            }

            escapeHtml(text) {
                const map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                };
                return text.replace(/[&<>"']/g, (m) => map[m]);
            }

            async logout() {
                try {
                    if (authToken) {
                        await fetch(`${API_BASE_URL}/auth/logout`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${authToken}`
                            }
                        });
                    }
                } catch (error) {
                    console.error('Erreur lors de la d√©connexion:', error);
                } finally {
                    // Supprimer l'utilisateur de la liste en ligne
                    if (currentUser) {
                        const userElement = document.querySelector(`[data-username="${currentUser.username}"]`);
                        if (userElement) {
                            userElement.remove();
                            this.updateOnlineCount();
                        }
                        this.showSystemMessage(`Agent ${currentUser.username} s'est d√©connect√©`);
                    }

                    // Nettoyer le stockage local
                    localStorage.removeItem('qvslv_token');
                    localStorage.removeItem('qvslv_user');
                    sessionStorage.removeItem('qvslv_token');
                    sessionStorage.removeItem('qvslv_user');
                    
                    currentUser = null;
                    authToken = null;
                    
                    this.updateUI(false);
                    this.showNotification('D√©connexion r√©ussie', 'success');
                    
                    // Masquer le menu utilisateur
                    document.getElementById('userMenu').style.display = 'none';
                }
            }

            showNotification(message, type = 'info') {
                const container = document.getElementById('notificationContainer');
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                
                const icons = {
                    success: '‚úÖ',
                    error: '‚ùå',
                    warning: '‚ö†Ô∏è',
                    info: '‚ÑπÔ∏è'
                };
                
                notification.innerHTML = `
                    <span class="notification-icon">${icons[type] || icons.info}</span>
                    <span class="notification-message">${message}</span>
                `;
                
                container.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.add('show');
                }, 100);
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 4000);
            }
        }

        // Syst√®me de particules (simplifi√©)
        class ParticleSystem {
            constructor() {
                this.initParticles();
            }

            initParticles() {
                const particlesContainer = document.getElementById('particles');
                const particleCount = 50;

                for (let i = 0; i < particleCount; i++) {
                    this.createParticle(particlesContainer, true);
                }

                setInterval(() => {
                    this.createParticle(particlesContainer);
                }, 3000);
            }

            createParticle(container, isInitial = false) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                particle.style.left = Math.random() * 100 + '%';
                
                if (isInitial) {
                    particle.style.top = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 10 + 's';
                } else {
                    particle.style.animationDelay = Math.random() * 3 + 's';
                }
                
                const size = Math.random() * 4 + 2;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                
                const duration = Math.random() * 8 + 8;
                particle.style.animationDuration = duration + 's';
                
                container.appendChild(particle);

                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, duration * 1000 + 3000);
            }
        }

        // Initialisation de l'application
        document.addEventListener('DOMContentLoaded', () => {
            // Initialiser les syst√®mes
            new AuthManager();
            new ParticleSystem();

            // Charger le script principal si il existe
            const existingScript = document.querySelector('script[src="/script/script.js"]');
            if (!existingScript) {
                const script = document.createElement('script');
                script.src = '/script/script.js';
                script.onerror = () => {
                    console.log('Script principal non trouv√©, utilisation des fonctionnalit√©s de base');
                };
                document.body.appendChild(script);
            }

            // Initialiser les fonctionnalit√©s de base
            initBasicFeatures();
        });

        // Fonctionnalit√©s de base
        function initBasicFeatures() {
            // Gestion du th√®me
            const themeToggle = document.getElementById('themeToggle');
            themeToggle?.addEventListener('click', () => {
                document.body.classList.toggle('dark-theme');
                themeToggle.textContent = document.body.classList.contains('dark-theme') ? '‚òÄÔ∏è' : 'üåô';
            });

            // Boutons de filtre
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });

            // Boutons de vue
            const viewBtns = document.querySelectorAll('.view-btn');
            viewBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    viewBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    const view = btn.getAttribute('data-view');
                    const grid = document.querySelector('.categories-grid');
                    if (grid) {
                        grid.className = `categories-grid ${view}-view`;
                    }
                });
            });

            // Recherche globale
            const searchInput = document.getElementById('globalSearch');
            searchInput?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const query = searchInput.value.trim();
                    if (query) {
                        console.log('Recherche:', query);
                        // Ici vous pourriez impl√©menter la recherche
                    }
                }
            });

            // Cartes de cat√©gories cliquables
            const categoryCards = document.querySelectorAll('.category-card');
            categoryCards.forEach(card => {
                card.addEventListener('click', () => {
                    const category = card.getAttribute('data-category');
                    console.log('Cat√©gorie s√©lectionn√©e:', category);
                    // Ici vous pourriez rediriger vers la page de cat√©gorie
                });
            });

            // Actions de la barre d'outils
            document.getElementById('randomDocument')?.addEventListener('click', () => {
                console.log('Document al√©atoire s√©lectionn√©');
                // Impl√©mentation future
            });

            document.getElementById('bookmarks')?.addEventListener('click', () => {
                console.log('Signets affich√©s');
                // Impl√©mentation future
            });

            document.getElementById('downloadMode')?.addEventListener('click', () => {
                console.log('Mode t√©l√©chargement activ√©');
                // Impl√©mentation future
            });

            // Notifications
            const notificationBtn = document.getElementById('notificationBtn');
            notificationBtn?.addEventListener('click', () => {
                console.log('Notifications affich√©es');
                // Impl√©mentation future
            });
        }
    </script>
</body>
</html>