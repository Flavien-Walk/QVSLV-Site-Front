<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QVSLV - Accr√©ditation</title>
    <link rel="icon" type="image/png" href="assets/accueil/favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles/register.css">
</head>
<body>
    <!-- Particules d'arri√®re-plan -->
    <div class="particles" id="particles"></div>
    
    <!-- Cadre d√©coratif du site -->
    <div class="site-frame">
        <div class="frame-corner top-left"></div>
        <div class="frame-corner top-right"></div>
        <div class="frame-corner bottom-left"></div>
        <div class="frame-corner bottom-right"></div>
        <div class="frame-border top"></div>
        <div class="frame-border bottom"></div>
        <div class="frame-border left"></div>
        <div class="frame-border right"></div>
    </div>

    <!-- Conteneur principal -->
    <div class="container">
        <!-- Header minimal -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-container">
                        <img src="/assets/accueil/logo.png" alt="QVSLV Logo" class="logo-image">
                        <div class="logo-text">
                            <h1 class="glitch" data-text="QVSLV">QVSLV</h1>
                            <span class="tagline">Archives & Documentation</span>
                        </div>
                    </div>
                </div>
                
                <nav class="back-nav">
                    <a href="login.html" class="nav-link">‚Üê Retour √† la connexion</a>
                </nav>
            </div>
        </header>

        <!-- Formulaire d'inscription -->
        <main class="register-main">
            <div class="register-container">
                <div class="register-header">
                    <h2>Demande d'Accr√©ditation</h2>
                    <p class="register-subtitle">Rejoignez le r√©seau QVSLV et acc√©dez aux archives classifi√©es</p>
                    <div class="clearance-level">
                        <span class="clearance-dot"></span>
                        <span class="clearance-text">Niveau d'habilitation: ANONYME ‚Üí V√âRIFI√â</span>
                    </div>
                </div>

                <form class="register-form" id="registerForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">Pr√©nom d'agent</label>
                            <div class="input-container">
                                <span class="input-icon">üë§</span>
                                <input type="text" id="firstName" name="firstName" placeholder="Pr√©nom" required>
                                <div class="input-glow"></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="lastName">Nom d'agent</label>
                            <div class="input-container">
                                <span class="input-icon">üè∑Ô∏è</span>
                                <input type="text" id="lastName" name="lastName" placeholder="Nom" required>
                                <div class="input-glow"></div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="username">Nom de code</label>
                        <div class="input-container">
                            <span class="input-icon">üî§</span>
                            <input type="text" id="username" name="username" placeholder="Choisissez votre nom de code" required>
                            <button type="button" class="generate-btn" id="generateUsername">üé≤</button>
                            <div class="input-glow"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="email">Contact s√©curis√©</label>
                        <div class="input-container">
                            <span class="input-icon">üìß</span>
                            <input type="email" id="email" name="email" placeholder="votre.email@exemple.com" required>
                            <div class="input-glow"></div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="password">Code d'acc√®s</label>
                            <div class="input-container">
                                <span class="input-icon">üîê</span>
                                <input type="password" id="password" name="password" placeholder="Cr√©ez votre code" required>
                                <button type="button" class="toggle-password" id="togglePassword">üëÅÔ∏è</button>
                                <div class="input-glow"></div>
                            </div>
                            <div class="password-strength" id="passwordStrength">
                                <div class="strength-bar"></div>
                                <span class="strength-text">Force du code</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="confirmPassword">Confirmation</label>
                            <div class="input-container">
                                <span class="input-icon">üîí</span>
                                <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirmez le code" required>
                                <div class="match-indicator" id="matchIndicator">‚ùå</div>
                                <div class="input-glow"></div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="specialization">Domaine de sp√©cialisation</label>
                        <div class="input-container">
                            <span class="input-icon">üß†</span>
                            <select id="specialization" name="specialization" required>
                                <option value="">Choisissez votre domaine</option>
                                <option value="archives">üìÇ Archives & Documentation</option>
                                <option value="ancient">üèõÔ∏è Civilisations Anciennes</option>
                                <option value="social">üß† Ing√©nierie Sociale</option>
                                <option value="tech">‚öôÔ∏è Technologies Oubli√©es</option>
                                <option value="consciousness">üåå Physique & Conscience</option>
                                <option value="symbols">üî∫ Symbolisme & Langage</option>
                                <option value="crypto">‚Çø Cryptomonnaies</option>
                                <option value="research">üîç Recherche G√©n√©rale</option>
                            </select>
                            <div class="input-glow"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="motivation">Motivation (optionnel)</label>
                        <div class="input-container">
                            <span class="input-icon">üí≠</span>
                            <textarea id="motivation" name="motivation" placeholder="Pourquoi souhaitez-vous rejoindre QVSLV ?" rows="3"></textarea>
                            <div class="input-glow"></div>
                        </div>
                    </div>

                    <div class="form-checkboxes">
                        <label class="checkbox-container">
                            <input type="checkbox" id="terms" name="terms" required>
                            <span class="checkmark"></span>
                            J'accepte les <a href="#" class="link">conditions d'utilisation</a> et la <a href="#" class="link">charte de confidentialit√©</a>
                        </label>

                        <label class="checkbox-container">
                            <input type="checkbox" id="secrecy">
                            <span class="checkmark"></span>
                            Je m'engage √† maintenir la confidentialit√© des informations classifi√©es
                        </label>

                        <label class="checkbox-container">
                            <input type="checkbox" id="newsletter">
                            <span class="checkmark"></span>
                            Recevoir les alertes de nouvelles archives (recommand√©)
                        </label>
                    </div>

                    <button type="submit" class="register-button" id="registerButton">
                        <span class="button-text">Demander l'Accr√©ditation</span>
                        <span class="button-glow"></span>
                    </button>

                    <div class="register-footer">
                        <p>D√©j√† accr√©dit√© ?</p>
                        <a href="login.html" class="login-link">Se connecter</a>
                    </div>
                </form>

                <!-- Processus d'accr√©ditation -->
                <div class="accreditation-process">
                    <h3>Processus d'Accr√©ditation</h3>
                    <div class="process-steps">
                        <div class="step">
                            <span class="step-number">1</span>
                            <span class="step-text">Soumission</span>
                        </div>
                        <div class="step">
                            <span class="step-number">2</span>
                            <span class="step-text">V√©rification</span>
                        </div>
                        <div class="step">
                            <span class="step-number">3</span>
                            <span class="step-text">Validation</span>
                        </div>
                        <div class="step">
                            <span class="step-number">4</span>
                            <span class="step-text">Acc√®s accord√©</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Messages d'alerte -->
        <div class="alert-container" id="alertContainer"></div>
    </div>

    <script>
        // Configuration API CORRIG√âE
        const API_BASE_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000/api' 
            : 'https://qvslv-site.onrender.com/api';

        // Syst√®me de particules simplifi√©
        class RegisterParticles {
            constructor() {
                this.initParticles();
            }

            initParticles() {
                const particlesContainer = document.getElementById('particles');
                const particleCount = 60;

                for (let i = 0; i < particleCount; i++) {
                    this.createParticle(particlesContainer, true);
                }

                setInterval(() => {
                    this.createParticle(particlesContainer);
                }, 2000);
            }

            createParticle(container, isInitial = false) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                particle.style.left = Math.random() * 100 + '%';
                
                if (isInitial) {
                    particle.style.top = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 8 + 's';
                } else {
                    particle.style.animationDelay = Math.random() * 2 + 's';
                }
                
                const size = Math.random() * 3 + 2;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                
                const duration = Math.random() * 6 + 6;
                particle.style.animationDuration = duration + 's';
                
                container.appendChild(particle);

                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, duration * 1000 + 2000);
            }
        }

        // Fonctionnalit√©s de la page
        document.addEventListener('DOMContentLoaded', () => {
            new RegisterParticles();

            // √âl√©ments du formulaire
            const togglePassword = document.getElementById('togglePassword');
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const matchIndicator = document.getElementById('matchIndicator');
            const passwordStrength = document.getElementById('passwordStrength');
            const generateUsernameBtn = document.getElementById('generateUsername');
            const usernameInput = document.getElementById('username');
            const registerForm = document.getElementById('registerForm');
            const registerButton = document.getElementById('registerButton');

            // Toggle password visibility
            togglePassword?.addEventListener('click', () => {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                togglePassword.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
            });

            // V√©rification de la force du mot de passe
            passwordInput?.addEventListener('input', () => {
                checkPasswordStrength();
                checkPasswordMatch();
            });

            confirmPasswordInput?.addEventListener('input', checkPasswordMatch);

            function checkPasswordStrength() {
                const password = passwordInput.value;
                const strengthBar = passwordStrength.querySelector('.strength-bar');
                const strengthText = passwordStrength.querySelector('.strength-text');
                
                let strength = 0;
                let text = 'Faible';
                let color = '#ff4444';

                if (password.length >= 8) strength++;
                if (/[A-Z]/.test(password)) strength++;
                if (/[a-z]/.test(password)) strength++;
                if (/[0-9]/.test(password)) strength++;
                if (/[^A-Za-z0-9]/.test(password)) strength++;

                if (strength >= 4) {
                    text = 'Fort';
                    color = '#00ff00';
                } else if (strength >= 3) {
                    text = 'Moyen';
                    color = '#ffa500';
                }

                strengthBar.style.width = (strength * 20) + '%';
                strengthBar.style.background = color;
                strengthText.textContent = text;
                strengthText.style.color = color;
            }

            function checkPasswordMatch() {
                const password = passwordInput.value;
                const confirmPassword = confirmPasswordInput.value;
                
                if (confirmPassword.length === 0) {
                    matchIndicator.textContent = '‚ùå';
                    matchIndicator.style.color = '#ff4444';
                } else if (password === confirmPassword) {
                    matchIndicator.textContent = '‚úÖ';
                    matchIndicator.style.color = '#00ff00';
                } else {
                    matchIndicator.textContent = '‚ùå';
                    matchIndicator.style.color = '#ff4444';
                }
            }

            // G√©n√©rateur de nom d'utilisateur
            generateUsernameBtn?.addEventListener('click', () => {
                const prefixes = ['Agent', 'Cipher', 'Shadow', 'Quantum', 'Vault', 'Truth', 'Code', 'Deep', 'Crypto', 'Mind'];
                const suffixes = ['Seeker', 'Keeper', 'Breaker', 'Walker', 'Hunter', 'Finder', 'Guard', 'Sight', 'Force', 'Link'];
                const numbers = Math.floor(Math.random() * 999) + 1;
                
                const randomPrefix = prefixes[Math.floor(Math.random() * prefixes.length)];
                const randomSuffix = suffixes[Math.floor(Math.random() * suffixes.length)];
                
                usernameInput.value = `${randomPrefix}${randomSuffix}${numbers}`;
                
                // Animation du bouton
                generateUsernameBtn.style.transform = 'rotate(360deg)';
                setTimeout(() => {
                    generateUsernameBtn.style.transform = 'rotate(0deg)';
                }, 300);
            });

            // Gestion du formulaire d'inscription
            registerForm?.addEventListener('submit', async (e) => {
                e.preventDefault();

                const formData = new FormData(registerForm);
                const data = Object.fromEntries(formData.entries());

                // V√©rifications c√¥t√© client
                if (data.password !== data.confirmPassword) {
                    showAlert('Les mots de passe ne correspondent pas', 'error');
                    return;
                }

                if (!formData.has('terms')) {
                    showAlert('Vous devez accepter les conditions d\'utilisation', 'error');
                    return;
                }

                // D√©sactiver le bouton pendant la requ√™te
                registerButton.disabled = true;
                registerButton.querySelector('.button-text').textContent = 'Cr√©ation en cours...';

                try {
                    showAlert('Demande d\'accr√©ditation en cours...', 'info');

                    const response = await fetch(`${API_BASE_URL}/auth/register`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            firstName: data.firstName,
                            lastName: data.lastName,
                            username: data.username,
                            email: data.email,
                            password: data.password,
                            specialization: data.specialization,
                            motivation: data.motivation || ''
                        })
                    });

                    const result = await response.json();

                    if (!response.ok) {
                        throw new Error(result.error || 'Erreur lors de la cr√©ation du compte');
                    }

                    showAlert('Compte cr√©√© avec succ√®s ! Redirection vers la connexion...', 'success');
                    
                    // Redirection vers login apr√®s 2 secondes
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);

                } catch (error) {
                    console.error('Erreur d\'inscription:', error);
                    showAlert(error.message || 'Erreur lors de l\'inscription', 'error');
                } finally {
                    // R√©activer le bouton
                    registerButton.disabled = false;
                    registerButton.querySelector('.button-text').textContent = 'Demander l\'Accr√©ditation';
                }
            });

            // Syst√®me d'alertes
            function showAlert(message, type = 'info') {
                const alertContainer = document.getElementById('alertContainer');
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.innerHTML = `
                    <span class="alert-icon">${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span>
                    <span class="alert-message">${message}</span>
                `;
                
                alertContainer.appendChild(alert);
                
                setTimeout(() => {
                    alert.classList.add('show');
                }, 100);
                
                setTimeout(() => {
                    alert.classList.remove('show');
                    setTimeout(() => {
                        if (alert.parentNode) {
                            alert.parentNode.removeChild(alert);
                        }
                    }, 300);
                }, 5000);
            }

            // Animation des √©tapes
            setTimeout(() => {
                const steps = document.querySelectorAll('.step');
                steps.forEach((step, index) => {
                    setTimeout(() => {
                        step.style.transform = 'scale(1.1)';
                        setTimeout(() => {
                            step.style.transform = 'scale(1)';
                        }, 200);
                    }, index * 300);
                });
            }, 1000);
        });
    </script>
</body>
</html>